<!DOCTYPE html>
<div id="container"></div>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script type="module">

// Declare the chart dimensions and margins.
const width = 640;
const height = width * 0.8;
const graticuleWidth = 10;
const graticuleHeight = 8;

// Declare the x (horizontal position) scale.
const x = d3.scaleLinear()
    .domain([-5, 5])
    .range([0, width]);

// Declare the y (vertical position) scale.
const y = d3.scaleLinear()
    .domain([-4, 4])
    .range([height, 0]);

// Create the SVG container.
const svg = d3.create("svg")
    .attr("width", width)
    .attr("height", height);

const defs = svg.append("defs");
const content = svg.append("g")
    .attr("transform", "scale(" + width / graticuleWidth + ", " + height / graticuleHeight + ") " +
        "translate(" + graticuleWidth / 2 + ", " + graticuleHeight / 2 + ")");

createGraticule(defs);
createTrace(defs);

content.append("use")
    .attr("href", "#graticule");

const aTrace = content.append("g")
    .attr("id", "a-trace")
    .attr("transform", "translate(" + -2*x(0)/2 + ", 0)");

aTrace.append("use")
            .attr("href", "#trace");

const bTrace = content.append("g")
    .attr("id", "b-trace")
    .attr("transform", "scale(10, 1) translate(" + -x(0) + ", " + y(0) + ") ");

bTrace.append("use")
        .attr("href", "#trace");

container.append(svg.node());

function createGraticule(parent) {
    // Create the graticule.
    const graticule = parent.append("g")
        .attr("id", "graticule")
        .classed('graticule', true);
    
    const grid = graticule.append("g")
        .attr("stroke-width", 0.01)
        .attr("stroke", "red")
        .attr("stroke-opacity", 0.5)
    
    const ticks = graticule.append("g")
        .attr("fill", "red")
        .attr("fill-opacity", 0.5);

    // The x-axis markers.
    x.ticks(10).map((tick) => {
        grid.append("line")
        .attr("x1", tick)
        .attr("x2", tick)
        .attr("y1", -4)
        .attr("y2", 4);});
    
    x.ticks(50).map((tick) => {
        grid.append("line")
        .attr("x1", tick)
        .attr("x2", tick)
        .attr("y1", -0.1)
        .attr("y2", 0.1);});
    
    x.ticks(50).map((tick) => {
        ticks.append("circle")
            .attr("cx", tick)
            .attr("cy", 2.5)
            .attr("r", 0.01);
            
        ticks.append("circle")
            .attr("cx", tick)
            .attr("cy", -2.5)
            .attr("r", 0.01);});

    // Y-axis markers.
    y.ticks(8).map((tick) => {
        grid.append("line")
            .attr("x1", -5)
            .attr("x2", 5)
            .attr("y1", tick)
            .attr("y2", tick);});

    y.ticks(40).map((tick) => {
        grid.append("line")
            .attr("x1", -0.1)
            .attr("x2", 0.1)
            .attr("y1", tick)
            .attr("y2", tick);});
}

function createTrace(parent) {
    const l = d3.line()
        .x(d => d[0])
        .y(d => d[1]);
    
    const trace = [];
    for (var t = 0; t < 12; ++t) {
        trace.push([t, 0]);
        trace.push([t + 0, 1]);
        trace.push([t + 0.05, 1]);
        trace.push([t + 0.15, 0]);
        trace.push([t + 1, 0]);
    }

    parent.append("path")
        .attr("id", "trace")
        .attr("d", l(trace))
        .attr("stroke", "green")
        .attr("fill", "none");
}

</script>